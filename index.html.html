<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOP Mentor AI - Tr√¨nh h·ªó tr·ª£ vi·∫øt lu·∫≠n ƒë·∫°i h·ªçc</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* CSS VARIABLES - Pastel Palette */
        :root {
            --primary-blue: #e3f2fd;
            --accent-blue: #1976d2;
            --primary-orange: #fff3e0;
            --accent-orange: #fb8c00;
            --bg-color: #f8f9fa;
            --text-dark: #2c3e50;
            --text-light: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Be Vietnam Pro', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            background: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        .logo-group h1 {
            font-size: 1.5rem;
            color: var(--accent-blue);
            font-weight: 700;
        }

        .logo-group p {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .btn-reset {
            background: var(--primary-orange);
            color: var(--accent-orange);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.3s;
        }

        .btn-reset:hover {
            background: var(--accent-orange);
            color: white;
        }

        /* --- MAIN LAYOUT --- */
        main {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 320px;
            background: white;
            border-left: 1px solid #eee;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-color);
            padding: 1.2rem;
            border-radius: var(--border-radius);
            border: 1px solid #eee;
        }

        .card h3 {
            font-size: 0.95rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Progress Tracker */
        .progress-item {
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .progress-bar {
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-blue);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Scoring */
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--accent-orange);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 auto 1rem;
        }

        .rubric-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        /* --- CHAT AREA --- */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--primary-blue);
            background-image: radial-gradient(#d1e9ff 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
        }

        #chat-window {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .msg {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 0.95rem;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .msg.ai {
            align-self: flex-start;
            background: white;
            color: var(--text-dark);
            border-bottom-left-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .msg.user {
            align-self: flex-end;
            background: var(--accent-blue);
            color: white;
            border-bottom-right-radius: 2px;
        }

        .typing {
            font-style: italic;
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 10px;
            display: none;
        }

        /* --- INPUT AREA --- */
        .input-area {
            background: white;
            padding: 1.5rem 2rem;
            border-top: 1px solid #eee;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            max-width: 900px;
            margin: 0 auto;
        }

        textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            resize: none;
            height: 50px;
            max-height: 150px;
            outline: none;
            transition: 0.3s;
        }

        textarea:focus {
            border-color: var(--accent-blue);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .btn-send {
            background: var(--accent-blue);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .btn-send:hover {
            transform: scale(1.05);
            background: #1565c0;
        }

        .btn-upload {
            background: #f1f2f6;
            color: #57606f;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            main { flex-direction: column; }
            .sidebar { width: 100%; height: 200px; border-left: none; border-top: 1px solid #eee; }
            .msg { max-width: 95%; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo-group">
            <h1>SOP Mentor AI üéì</h1>
            <p>Ng∆∞·ªùi b·∫°n ƒë·ªìng h√†nh chinh ph·ª•c gi·∫•c m∆° du h·ªçc</p>
        </div>
        <button class="btn-reset" onclick="resetSession()">L√†m m·ªõi phi√™n chat</button>
    </header>

    <main>
        <section class="chat-container">
            <div id="chat-window">
                </div>
            <div id="typing-indicator" class="typing" style="margin-left: 2rem;">Mentor ƒëang so·∫°n c√¢u tr·∫£ l·ªùi...</div>
            
            <div class="input-area">
                <div class="input-wrapper">
                    <button class="btn-upload" title="T·∫£i l√™n b·∫£n nh√°p" onclick="triggerUpload()">üìé</button>
                    <input type="file" id="file-input" hidden accept=".txt,.doc,.docx">
                    <textarea id="user-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi ho·∫∑c d√°n b√†i lu·∫≠n c·ªßa b·∫°n t·∫°i ƒë√¢y..."></textarea>
                    <button class="btn-send" onclick="handleSendMessage()">üöÄ</button>
                </div>
            </div>
        </section>

        <aside class="sidebar">
            <div class="card">
                <h3>üìà Ti·∫øn ƒë·ªô ho√†n th√†nh</h3>
                <div class="progress-item">
                    <span>Th√¥ng tin c√° nh√¢n</span>
                    <div class="progress-bar"><div id="p1" class="progress-fill"></div></div>
                </div>
                <div class="progress-item">
                    <span>X√°c ƒë·ªãnh m·ª•c ti√™u</span>
                    <div class="progress-bar"><div id="p2" class="progress-fill"></div></div>
                </div>
                <div class="progress-item">
                    <span>C·∫•u tr√∫c SOP</span>
                    <div class="progress-bar"><div id="p3" class="progress-fill"></div></div>
                </div>
            </div>

            <div class="card" id="scoring-panel">
                <h3>üìä ƒê√°nh gi√° b√†i lu·∫≠n</h3>
                <div class="score-circle" id="total-score">--</div>
                <div class="rubric-list">
                    <div class="rubric-item"><span>ƒê·ªô r√µ r√†ng (Clarity)</span><b id="s-clarity">0/10</b></div>
                    <div class="rubric-item"><span>ƒê·ªông l·ª±c (Motivation)</span><b id="s-motivation">0/10</b></div>
                    <div class="rubric-item"><span>C·∫•u tr√∫c (Structure)</span><b id="s-structure">0/10</b></div>
                    <div class="rubric-item"><span>C√° nh√¢n h√≥a (Story)</span><b id="s-story">0/10</b></div>
                </div>
                <div id="ai-suggestion" style="font-size: 0.8rem; margin-top: 10px; color: #666; border-top: 1px solid #ddd; padding-top: 10px;">
                    D√°n b√†i lu·∫≠n ƒë·ªÉ nh·∫≠n g·ª£i √Ω c·∫£i thi·ªán.
                </div>
            </div>

            <div class="card">
                <h3>‚úÖ SOP Checklist</h3>
                <div style="font-size: 0.85rem; display: flex; flex-direction: column; gap: 5px;">
                    <label><input type="checkbox" id="check-intro"> M·ªü b√†i ·∫•n t∆∞·ª£ng</label>
                    <label><input type="checkbox" id="check-goals"> M·ª•c ti√™u ngh·ªÅ nghi·ªáp r√µ r√†ng</label>
                    <label><input type="checkbox" id="check-fit"> T·∫°i sao ch·ªçn tr∆∞·ªùng n√†y?</label>
                    <label><input type="checkbox" id="check-proof"> Minh ch·ª©ng th√†nh t√≠ch</label>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // TR·∫†NG TH√ÅI NG∆Ø·ªúI D√ôNG
        let state = {
            step: 0,
            userData: {
                major: '',
                country: '',
                school: '',
                experience: '',
                motivation: '',
                stage: ''
            },
            history: []
        };

        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const typingIndicator = document.getElementById('typing-indicator');

        // B·ªò C√ÇU H·ªéI MENTOR
        const questions = [
            "Ch√†o b·∫°n! M√¨nh l√† Mentor AI. R·∫•t vui ƒë∆∞·ª£c ƒë·ªìng h√†nh c√πng b·∫°n vi·∫øt SOP. ƒê·∫ßu ti√™n, b·∫°n d·ª± ƒë·ªãnh ·ª©ng tuy·ªÉn v√†o **Ng√†nh h·ªçc** n√†o v√† t·∫°i **Qu·ªëc gia** n√†o?",
            "Tuy·ªát v·ªùi! B·∫°n ƒë√£ c√≥ **Tr∆∞·ªùng m·ª•c ti√™u** c·ª• th·ªÉ n√†o ch∆∞a? V√† ƒëi·ªÅu g√¨ khi·∫øn b·∫°n ch·ªçn ng√†nh n√†y thay v√¨ nh·ªØng ng√†nh kh√°c?",
            "H√£y chia s·∫ª m·ªôt v√†i **Th√†nh t√≠ch n·ªïi b·∫≠t** ho·∫∑c ho·∫°t ƒë·ªông ngo·∫°i kh√≥a m√† b·∫°n t√¢m ƒë·∫Øc nh·∫•t nh√©!",
            "C·∫£m ∆°n b·∫°n. Hi·ªán t·∫°i b·∫°n ƒëang ·ªü giai ƒëo·∫°n n√†o: \n1. Ch∆∞a bi·∫øt b·∫Øt ƒë·∫ßu t·ª´ ƒë√¢u \n2. ƒê√£ c√≥ d√†n √Ω \n3. ƒê√£ c√≥ b·∫£n nh√°p c·∫ßn s·ª≠a",
            "R·∫•t r√µ r√†ng. B√¢y gi·ªù, h√£y g·ª≠i b·∫£n nh√°p ho·∫∑c ƒë·∫∑t c√¢u h·ªèi cho m√¨nh. N·∫øu ch∆∞a c√≥ b·∫£n nh√°p, h√£y g√µ 'H∆∞·ªõng d·∫´n' ƒë·ªÉ m√¨nh gi√∫p b·∫°n x√¢y d·ª±ng c·∫•u tr√∫c nh√©!"
        ];

        // KH·ªûI T·∫†O
        window.onload = () => {
            const savedState = localStorage.getItem('sop_mentor_state');
            if (savedState) {
                state = JSON.parse(savedState);
                renderHistory();
            } else {
                addMessage('ai', questions[0]);
            }
            updateUI();
        };

        function addMessage(sender, text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${sender}`;
            msgDiv.innerHTML = text.replace(/\n/g, '<br>');
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            state.history.push({ sender, text });
            saveState();
        }

        function handleSendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            addMessage('user', text);
            userInput.value = '';
            
            // Hi·ªán hi·ªáu ·ª©ng g√µ
            typingIndicator.style.display = 'block';
            
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                processAI(text);
            }, 1000);
        }

        // SOP SCORING LOGIC (MOCK)
        function analyzeSOP(text) {
            // Logic ƒë∆°n gi·∫£n ƒë·ªÉ demo: t√≠nh ƒëi·ªÉm d·ª±a tr√™n ƒë·ªô d√†i v√† t·ª´ kh√≥a
            const length = text.length;
            const keywords = ['nghi√™n c·ª©u', 'm·ª•c ti√™u', 'k·ªπ nƒÉng', 'ƒë√≥ng g√≥p', 'kinh nghi·ªám', 't·∫°i sao', 'ƒë·∫°i h·ªçc', 'research', 'passion', 'goal'];
            let foundKeywords = keywords.filter(word => text.toLowerCase().includes(word)).length;

            const scores = {
                clarity: Math.min(10, Math.floor(length / 200) + 2),
                motivation: Math.min(10, foundKeywords + 1),
                structure: text.split('\n').filter(p => p.length > 50).length >= 4 ? 9 : 5,
                story: text.includes("t√¥i") || text.includes("m√¨nh") || text.includes("I ") ? 8 : 4
            };

            const total = (scores.clarity + scores.motivation + scores.structure + scores.story) * 2.5;
            
            // C·∫≠p nh·∫≠t giao di·ªán
            document.getElementById('total-score').innerText = Math.round(total);
            document.getElementById('s-clarity').innerText = `${scores.clarity}/10`;
            document.getElementById('s-motivation').innerText = `${scores.motivation}/10`;
            document.getElementById('s-structure').innerText = `${scores.structure}/10`;
            document.getElementById('s-story').innerText = `${scores.story}/10`;

            let suggestion = "";
            if (total < 50) suggestion = "G·ª£i √Ω: B√†i vi·∫øt h∆°i ng·∫Øn. H√£y m·ªü r·ªông ph·∫ßn ƒë·ªông l·ª±c c√° nh√¢n v√† m·ª•c ti√™u ngh·ªÅ nghi·ªáp.";
            else if (total < 80) suggestion = "G·ª£i √Ω: Kh√° t·ªët! B·∫°n n√™n th√™m c√°c v√≠ d·ª• c·ª• th·ªÉ v·ªÅ th√†nh t√≠ch ƒë·ªÉ tƒÉng t√≠nh thuy·∫øt ph·ª•c.";
            else suggestion = "G·ª£i √Ω: Tuy·ªát v·ªùi! H√£y r√† so√°t l·ªói ch√≠nh t·∫£ v√† ng·ªØ ph√°p cu·ªëi c√πng.";
            
            document.getElementById('ai-suggestion').innerText = suggestion;
            
            // T·ª± ƒë·ªông check checklist
            document.getElementById('check-intro').checked = length > 100;
            document.getElementById('check-goals').checked = foundKeywords > 3;
            document.getElementById('check-fit').checked = text.toLowerCase().includes("tr∆∞·ªùng") || text.toLowerCase().includes("university");

            return total;
        }

        function processAI(input) {
            let response = "";

            // N·∫øu ng∆∞·ªùi d√πng d√°n m·ªôt ƒëo·∫°n vƒÉn d√†i (gi·∫£ ƒë·ªãnh l√† b√†i lu·∫≠n)
            if (input.length > 300) {
                const score = analyzeSOP(input);
                response = `T√¥i ƒë√£ nh·∫≠n ƒë∆∞·ª£c b·∫£n th·∫£o c·ªßa b·∫°n. ƒêi·ªÉm ƒë√°nh gi√° s∆° b·ªô l√† **${Math.round(score)}/100**. \n\nT√¥i ƒë√£ c·∫≠p nh·∫≠t ph√¢n t√≠ch chi ti·∫øt ·ªü c·ªôt b√™n ph·∫£i. B·∫°n mu·ªën t√¥i s·ª≠a chi ti·∫øt ph·∫ßn n√†o ƒë·∫ßu ti√™n?`;
            } else if (input.toLowerCase().includes("h∆∞·ªõng d·∫´n")) {
                response = "D∆∞·ªõi ƒë√¢y l√† c·∫•u tr√∫c SOP chu·∫©n: \n1. **M·ªü b√†i**: C√¢u chuy·ªán d·∫´n d·∫Øt ·∫•n t∆∞·ª£ng. \n2. **H·ªçc thu·∫≠t**: Qu√° tr√¨nh h·ªçc t·∫≠p c·ªßa b·∫°n. \n3. **Kinh nghi·ªám**: Nh·ªØng g√¨ b·∫°n ƒë√£ l√†m. \n4. **ƒê·ªông l·ª±c**: T·∫°i sao ch·ªçn ng√†nh/tr∆∞·ªùng n√†y? \n5. **M·ª•c ti√™u**: T·∫ßm nh√¨n 5-10 nƒÉm t·ªõi. \n\nB·∫°n mu·ªën vi·∫øt nh√°p ph·∫ßn n√†o tr∆∞·ªõc?";
                state.step = 4;
            } else if (state.step < questions.length - 1) {
                state.step++;
                response = questions[state.step];
            } else {
                response = "T√¥i hi·ªÉu r·ªìi. B·∫°n c√≥ mu·ªën t√¥i gi√∫p t·ªëi ∆∞u h√≥a ƒëo·∫°n vƒÉn n√†o c·ª• th·ªÉ kh√¥ng, hay b·∫°n c·∫ßn th√™m v√≠ d·ª• v·ªÅ ph·∫ßn 'ƒê·ªông l·ª±c ch·ªçn tr∆∞·ªùng'?";
            }

            addMessage('ai', response);
            updateUI();
        }

        function updateUI() {
            // Update Progress Bars
            const p1 = Math.min(100, (state.step / 1) * 100);
            const p2 = state.step >= 2 ? 100 : (state.step > 1 ? 50 : 0);
            const p3 = state.step >= 4 ? 60 : 0;

            document.getElementById('p1').style.width = `${p1}%`;
            document.getElementById('p2').style.width = `${p2}%`;
            document.getElementById('p3').style.width = `${p3}%`;
        }

        function saveState() {
            localStorage.setItem('sop_mentor_state', JSON.stringify(state));
        }

        function renderHistory() {
            chatWindow.innerHTML = '';
            state.history.forEach(m => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `msg ${m.sender}`;
                msgDiv.innerHTML = m.text.replace(/\n/g, '<br>');
                chatWindow.appendChild(msgDiv);
            });
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function resetSession() {
            if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch s·ª≠ chat v√† b·∫Øt ƒë·∫ßu l·∫°i?")) {
                localStorage.removeItem('sop_mentor_state');
                location.reload();
            }
        }

        function triggerUpload() {
            document.getElementById('file-input').click();
        }

        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                addMessage('user', `[ƒê√£ t·∫£i l√™n t·ªáp: ${file.name}]`);
                setTimeout(() => {
                    addMessage('ai', "T√¥i ƒë√£ nh·∫≠n ƒë∆∞·ª£c file. Tuy nhi√™n v√¨ ƒë√¢y l√† b·∫£n Demo, b·∫°n h√£y copy n·ªôi dung t·ªáp v√† d√°n tr·ª±c ti·∫øp v√†o khung chat ƒë·ªÉ t√¥i ph√¢n t√≠ch nh√©! ‚úçÔ∏è");
                }, 800);
            }
        });

        // T·ª± ƒë·ªông gi√£n n·ªü textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Enter ƒë·ªÉ g·ª≠i
        userInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        });
    </script>
</body>
</html>